<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">
			const GradeExamCount = {
				math: [],
				science: [],
				english: [],
				social_studies: [],
				additional: [],
				world_language: [],
			};
			const CHECKMARK_SVG =
				'<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" width="16" height="16" class="bi bi-check" viewBox="0 0 16 16"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/></svg>';
			const NA_SVG =
				'<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" width="16" height="16" class="bi bi-na" viewBox="0 0 16 16"><rect x="4" y="7" width="8" height="2" rx="1"></rect></svg>';
			const X_SVG =
				'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>';
			const DIVIDER_SVG =
				'<svg preserveAspectRatio="none" width="4" height="4" class="div" fill="currentColor" viewBox="0 0 4 4"></svg>';
			const WARNING_SVG =
				'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>';
			const LIGHT_GREEN = "#77ff7733";
			const LIGHT_GREY = "#aaaaaa33";
		</script>
		<script src="./plotly.js"></script>
		<script src="./erep.js"></script>
		<script src="./courseData.js"></script>
		<script src="./plotlyDark.js"></script>
		<script src="./conversion.js"></script>
		<script type="text/javascript" defer>
			var isDarkMode = false;
			if (window.ERep === undefined) {
				window.ERep = {
					Log: (v, l) => {
						console.log(v);
					},
				};
			}
			/*Error Handling*/ var l = false;
			function presentError(m, oe, t = "") {
				if (!l) {
					window.onload = () => {
						l = true;
						presentError(m, oe, t);
					};
					return;
				}
				document.getElementById("errormessage").innerHTML = m;
				document.getElementById("errortype").innerHTML = t;
				document.getElementById("errorbox").removeAttribute("style");
				throw oe;
			}
			window.onload = () => {
				l = true;
				errorHandle(loadCall);
			};
			class NotFound extends Error {
				constructor(message) {
					super(message);
				}
			}
			try {
				if (window.COURSE_DATA_LOADED === undefined) {
					throw new NotFound("COURSE_DATA_NOT_FOUND")
				}
				if (window.PLOTLY_DARK_LOADED === undefined) {
					throw new NotFound("PLOTLY_DARK_NOT_FOUND")
				}
				if (window.CONVERSION_LOADED === undefined) {
					throw new NotFound("CONVERSION_NOT_FOUND")
				}
				var takenCourses = [];
				var filterGrades = [9,10,11,12]
				/**
				 * Search Courses for a course
				 * 
				 * Either name, cid, or both can be passed to find a course
				 * @param {string} name - The name of the course to search for
				 * @param {string} cid - The courseID of the course to search for
				 * @returns {course} - A course object (from courseData)
				 */
				function searchCourses(name = "", cid = "") {
					let foundCourses = [];
					for (let i = 0; i < Courses.length; i++) { // Iterate through courses
						if (
							(Courses[i].name.toLowerCase().search(name.toLowerCase()) != -1 && name != "") ||
							(Courses[i].cid.toLowerCase().search(cid.toLowerCase()) != -1 && cid != "")
						) { // Test if the name or cid matches
							foundCourses.push(Courses[i]); // Add course to found courses
						}
					}
					return foundCourses;
				}
				var scannedCourses = [];
				/**
				 * Search Prerequisites for a course and output them as a graph relation list
				 * 
				 * Graph Relation list - [PrerequisiteName, StartingCourseName, PrerequisiteType]
				 * @param {string} inname - The name of the course
				 * @param {[String]} prerequisites - A list of prerequisites to search through
				 * @param {[PREREQUISITE]} prerequisite_types - A list of prerequisites types that match prerequisites argument
				 * @param {boolean} displayNoPrerequisite - Should the 'No Prerequisite' be returned
				 * @param {number} recursion - The depth of recursion that the function is at, prevents infinite loops
				 * @returns {[[string, string, number]]} - Graph Relation list - [PrerequisiteName, StartingCourseName, PrerequisiteType], used for generation of graphs
				 */
				function preSearch(inname, prerequisites, prerequisite_types, displayNoPrerequisite = false, recursion = 0) {
					let coursePrerequisites = [];
					if (prerequisites.length === 0 && displayNoPrerequisite) { // If there are no prerequisites and displayNoPrerequisite = true
						return [["No Prerequisite", inname, PREREQUISITE_NONE]]; // Return relation to no prerequisites
					}
					for (let i = 0; i < prerequisites.length; i++) {
						let prerequisite = [prerequisites[i], inname, prerequisite_types[i]]; // The value we will add if it's not already scanned
						if (
							scannedCourses.findIndex((e) => {
								return e[0] === prerequisite[0] && e[1] === prerequisite[1] && e[2] === prerequisite[2];
							}) === -1
						) { // Test if the prerequisite matches a already scanned prerequisite
							coursePrerequisites.push(prerequisite); // Add to course prerequisites
							let results = searchCourses(prerequisites[i]); // Search for the prerequisite course
							if (results.length >= 1 && recursion <= 10) { // If it exists and we have not hit max recursion
								if (results[0].prerequisites.length > 0) { // If it has prerequisites
									for (var prerequisiteIndex = 0; prerequisiteIndex < results.length; prerequisiteIndex++) { // Go through each prerequisite
										if (results[prerequisiteIndex].prerequisites.length > 0) { // If it has prerequisites
											let out = preSearch(
												prerequisites[i],
												results[prerequisiteIndex].prerequisites,
												results[prerequisiteIndex].prerequisite_types,
												displayNoPrerequisite,
												recursion + 1
												); // Search through it's prerequisites
											coursePrerequisites = coursePrerequisites.concat(out); // Add them to coursePrerequisites
										}
									}
								}
							}
							scannedCourses.push(prerequisite); // Add to scanned prerequisites
						}
					}
					return coursePrerequisites;
				}
				/**
				 * Generate the Prerequisite graph for a course
				 * 
				 * @param {course} course - The course to generate the graph for
				 * @returns {void}
				 */
				function GeneratePrerequisiteGraph(course) {
					var layout = {
						font: {
							size: 10,
						},
						margin: {
							t: 0,
							l: 0,
							r: 0,
							b: 0,
						},
						template: isDarkMode ? plotly_dark : {},
					}; // The layout and theme for the graph
					var data = [];
					try {
						scannedCourses = [];
						data = preSearch(course.name, course.prerequisites, course.prerequisite_types);
					} catch (e2) {
						presentError(e2, e2, " - Data Parsing");
					}
					var label = [];
					var color = [];
					var linkcolor = [];
					var source = [];
					var target = [];
					var value = [];
					for (var i = 0; i < data.length; i++) { // Go through the prerequisite data
						var inID = label.findIndex((e) => {
							return e === data[i][0] || e === data[i][0] + " &#10003;";
						}); // The index of the label (part) if it was already generated
						let greyify = false;
						if (inID === -1) { // If the label (part) was not generated, generate it
							let taken =
								takenCourses.findIndex((e) => {
									return e.name === data[i][0];
								}) === -1; // Was the course taken before?
							label.push(taken ? data[i][0] : data[i][0] + " &#10003;"); // If taken label it with a checkmark and add it to labels
							let or_check = coursePrerequisitesMet(
								Courses[
									Courses.findIndex((e) => {
										return e.name === data[i][1] || e.name === data[i][1] + " &#10003;";
									})
								], // The root course that this prerequisite is required for
								true
							); // Is there a OR part in the prerequisites for the root course?
							if (or_check[0] && data[i][2] === PREREQUISITE_OR && or_check[1]) { // If there is a OR prerequisite and the current prerequisite is part of it
								color.push(taken ? LIGHT_GREY : LIGHT_GREEN); // Make the label green if it's taken and grey if it's not
								if (taken) {
									greyify = true; // Make the link grey
								}
							} else {
								color.push(taken ? convertPrerequisiteTypeToColor(data[i][2]) : LIGHT_GREEN); // If the prerequisite is not part of a OR set it's color accordingly
							}
							inID = label.length - 1; // The label is now generated and is at the end of the label array
						}
						var outID = label.findIndex((e) => {
							return e === data[i][1] || e === data[i][1] + " &#10003;";
						}); // The index of the label (part) if it was already generated
						if (outID === -1) { // If the label (part) was not generated, generate it
							let taken =
								takenCourses.findIndex((e) => {
									return e.name === data[i][1];
								}) === -1; // Was the course taken before?
							label.push(taken ? data[i][1] : data[i][1] + " &#10003;"); // If taken label it with a checkmark and add it to labels
							color.push(taken ? convertPrerequisiteTypeToColor(data[i][2]) : LIGHT_GREEN); // If the course is complete color the label gray, if not color it the way it should be
							outID = label.length - 1; // The label is now generated and is at the end of the label array
						}
						source.push(inID); // Create a link from the root course
						target.push(outID); // To the prerequisite
						let lnc = ""; // Link color
						if (
							takenCourses.findIndex((e) => {
								return e.name === data[i][0];
							}) === -1
						) { // If not taken
							if (greyify) {
								lnc = LIGHT_GREY; // If prerequisite is handled by another color it grey, (only for OR)
							} else {
								lnc = convertPrerequisiteTypeToColorLight(data[i][2]); // Color it accordingly
							}
						} else {
							lnc = LIGHT_GREEN; // We have met the prerequisite, color the link green
						}
						linkcolor.push(lnc); // Add the link color to the link
						value.push(1); // Make sure all links are at the same scale
					}
					var dataObj = {
						type: "sankey",
						orientation: "h",
						node: {
							pad: 10,
							thickness: 10,
							line: {
								color: "black",
								width: 0,
							},
							label: label,
							color: color,
						},

						link: {
							source: source,
							target: target,
							value: value,
							color: linkcolor,
						},
						//arrangement: 'snap',
						hoverinfo: false,
					}; // The data that we are adding in a format that Plotly can understand
					var dataObj = [dataObj]; // Put it in a array so Plotly can use it
					Plotly.react("preflow", dataObj, layout, {
						scrollZoom: true,
						responsive: true,
						modebar_add: ["zoom", "pan"],
					}); // Generate the graph in div#preflow (found in: index.html > html > body > div#infobox > div > div#preflow)
				}
				/**
				 * Checks if the prerequisites are met for a course
				 * 
				 * @param {course} inname - The name of the course
				 * @param {boolean} just_or - Should only prerequisites that are marked with OR should be checked
				 * @returns {boolean | [boolean, boolean]} - If just_or is true return if there was an OR and if it is satisfied, If just_or is false return if all prerequisites are met
				 */
				function coursePrerequisitesMet(course, just_or = false) {
					if (course === undefined) {
						ERep.Log("It appears that a undefined course was passed to check Pre-Req's");
						return false;
					}
					let presOrComplete = false;
					let containedOr = false;
					for (var i = 0; i < course.prerequisites.length; i++) { // Search through prerequisites
						if (course.prerequisite_types[i] === PREREQUISITE_OR) {
							containedOr = true; // There is a OR in the prerequisites
						}
						if (
							course.prerequisite_types[i] === PREREQUISITE_OR &&
							takenCourses.findIndex((e) => {
								return e.name === course.prerequisites[i];
							}) != -1
						) { // Is one of the OR prerequisites complete? If complete break
							presOrComplete = true;
							break;
						}
					}
					if (just_or) {
						return [containedOr, presOrComplete]; // See @returns
					}
					if (!presOrComplete && containedOr) {
						return false; // If the OR prerequisites are not satisfied prerequisites are not complete
					}
					for (var i = 0; i < course.prerequisites.length; i++) { // Go through all prerequisites
						if (
							takenCourses.findIndex((e) => {
								return e.name === course.prerequisites[i];
							}) === -1
						) { // If the course was not taken
							if (presOrComplete && course.prerequisite_types[i] === PREREQUISITE_OR) { // If OR we have another one that is satisfied
								continue;
							} else if (course.prerequisite_types[i] === PREREQUISITE_RECOMMENDED) { // If it's only recommended it's not required to complete
								continue;
							} else { // If it's not complete and it's required, the prerequisites are not complete
								return false;
							}
						}
					}
					return true; // All the prerequisites are complete
				}
				/**
				 * Display a course on the screen
				 * 
				 * @param {course} course - The course to display
				 * @returns {void}
				 */
				function showCourse(course) {
					document.getElementById("infobox").style.display = "flex"; // The default display is none, set it so it's visible
					document.querySelector("#infobox > #infoboxdata > h3").innerHTML = course.name; // Set the course name
					let divs = document.querySelectorAll("#infobox > #infoboxdata > div"); // A list of div's in infoboxdata
					divs[0].innerHTML = course.cid; // Set the course ID
					let credits = ""; // HTML of credits to display
					for (var i = 0; i < course.credits.length; i++) { // For all credits
						let creditName = convertCreditToText(course.credits[i][0]); // Get credit name in text
						credits += `${i === 0 ? "" : ", "}<span>${creditName === "Commencement" ? 1 : course.credits[i][1]} ${creditName} Credit</span>`; // Add the credit to the list, if it's a commencement credit set the number of credits to 1 (The default is 0)
					}
					divs[1].innerHTML = credits; // Display credits
					let exams = ""; // HTML of exams to display
					for (var i = 0; i < course.exams.length; i++) { // For all exams
						exams += `${i === 0 ? "" : ", "}<span>${convertExamToText(course.exams[i])} Exam</span>`; // Add the exam to the list
					}
					divs[2].innerHTML = exams; // Display exams
					let prerequisites = ""; // HTML of prerequisites to display
					let prerequisitesOrComplete = coursePrerequisitesMet(course, true)[1]; // Variable to track if prerequisites are complete
					let prerequisites_complete = true;
					for (var i = 0; i < course.prerequisites.length; i++) { // Go through all the prerequisites
						let svg = ""; // The SVG to add to the end of the prerequisite
						if (
							takenCourses.findIndex((e) => {
								return e.name === course.prerequisites[i];
							}) === -1
						) { // If the course is NOT complete
							if (prerequisitesOrComplete && course.prerequisite_types[i] === PREREQUISITE_OR) { // If it's a OR and we know that there is another one, display an N/A symbol
								svg = NA_SVG;
							} else if (course.prerequisite_types[i] === PREREQUISITE_RECOMMENDED) { // If it's a recommend course display an N/A symbol because it's not required
								svg = NA_SVG;
							} else { // If it's just not done
								svg = X_SVG;
								prerequisites_complete = false;
							}
						} else {
							svg = CHECKMARK_SVG; // Prerequisite is complete and can be marked with a check
						}
						prerequisites += `${i === 0 ? "" : ",&nbsp"}<span>${course.prerequisites[i]}</span>${svg}`; // Add the prerequisite with the SVG
					}
					document.getElementById("pres").innerHTML = prerequisites; // Display all the prerequisites
					let prerequisiteTitle = document.getElementById("pretitle"); // The element for if all the prerequisites are met
					prerequisiteTitle.innerHTML = prerequisites_complete ? "COMPLETE " + CHECKMARK_SVG : "INCOMPLETE " + X_SVG;
					prerequisiteTitle.className = prerequisites_complete ? "accepted" : "failed";
					errorHandle(() => {
						GeneratePrerequisiteGraph(course); // Generate the prerequisite graph
					});
				}
				/**
				 * Check if the user needs to input their regents score for the course to calculate diploma progress
				 * 
				 * @param {course} course - Course to test
				 * @returns {[boolean, number]} - Do we need to prompt for score and for what credit type
				*/
				function checkIfExamScoreRequired(course) {
					switch (course.cid) {
						case "0406":
							return [true, MATH_CREDIT]
						case "0411":
							return [true, MATH_CREDIT]
						case "0442":
							return [true, MATH_CREDIT]
						case "0440":
							return [true, MATH_CREDIT]
						case "0443":
							return [true, MATH_CREDIT]
						default:
							return [false, 0] // It does not match a course we need a grade for
					}
				}
				/**
				 * Add the exam and score to the credit type
				 * 
				 * @param {course} cc - The course to add the score for
				 * @param {number} score - The score on the exam
				 * @param {credit} type - The credit type for the course
				 * @returns {void}
				*/
				function pushRegentsExamScore(cc, score, type) {
					let addingData = [cc.cid, score] // The data being added
					switch (type) {
						case MATH_CREDIT:
							GradeExamCount.math.push(addingData) // Add to math exams
							return
					}
				}
				async function promptForRegentsExamScore(cc) {
					let checkResult = checkIfExamScoreRequired(cc)
					if (!checkResult[0]) {
						return;
					}
					return new Promise((resolve) => {
						document.getElementById("res").style.display = "block";
						let rescalcElement = document.getElementById("rescalc");
						rescalcElement.addEventListener("click", () => {
							let input = document.getElementById("resinp")
							let matched = input.value.match(/\d+/g)
							let out = ""
							for (let i = 0; i < matched.length; i++) {
								out += parseInt(matched[i])
							}
							pushRes(cc, out, checkResult[1])
							document.getElementById("res").style.display = "none";
							resolve("")
						}, { once: true })
					})
				}
				async function addTakenCourse(e) {
					var cc = Courses[parseInt(e.currentTarget.id.split("atcid")[1])];
					if (e.target.id === "ell") {
						showCourse(cc);
						return;
					}
					if (
						takenCourses.findIndex((e) => {
							return e === cc;
						}) === -1
					) {
						var ev = e.currentTarget;
						await promptForRegentsExamScore(cc);
						takenCourses.push(cc);
						ev.lastChild.innerHTML = CHECKMARK_SVG + ev.lastChild.innerHTML;
						PropagateTakenCourses();
						PropagateCourseChart();
					} else {
						takenCourses.splice(
							takenCourses.findIndex((e) => {
								return e === cc;
							}),
							1
						);
						e.currentTarget.lastChild.firstChild.remove();
						PropagateTakenCourses();
						PropagateCourseChart();
					}
				}
				function PropagateTakenCourseSearchResults() {
					document.getElementById("addcompletesugglist").innerHTML = "";
					let results = searchCourses(
						document.getElementById("addcompletename").value,
						document.getElementById("addcompletecid").value
					);
					var frag = document.createDocumentFragment();
					for (var i = 0; i < results.length; i++) {
						let creds = "";
						for (var ci = 0; ci < results[i].credits.length; ci++) {
							let cctt = convertCreditToText(results[i].credits[ci][0]);
							if (cctt === "Commencement") {
								creds += `${DIVIDER_SVG}<span>${cctt} Credit</span>`;
							} else {
								creds += `${DIVIDER_SVG}<span>${results[i].credits[ci][1]} ${cctt} Credit</span>`;
							}
						}
						let tmp = `
							<div class="tcf">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16" id="ell" style="overflow: visible; ">
									<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
									<path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
								</svg>
								<h5>${results[i].name}</h5>
							</div>
							<div class="tcf">
								${
									takenCourses.findIndex((e) => {
										return e === results[i];
									}) === -1
										? ""
										: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/></svg>'
								}
								<div class="cid">${results[i].cid}</div>
								${creds}
							</div>`;
						let temp = document.createElement("li");
						temp.innerHTML = tmp;
						temp.id =
							"atcid" +
							Courses.findIndex((e) => {
								return e === results[i];
							});
						temp.addEventListener("click", addTakenCourse);
						frag.appendChild(temp);
					}
					document.getElementById("addcompletesugglist").appendChild(frag);
					if (results.length === 0) {
						document.getElementById("addcompletesugglist").innerHTML = "<p>No Results</p>";
					}
				}
				function PropagateTakenCourses() {
					document.getElementById("takenCourses").innerHTML = "";
					var frag = document.createDocumentFragment();
					for (let i = 0; i < takenCourses.length; i++) {
						let creds = "";
						for (var ci = 0; ci < takenCourses[i].credits.length; ci++) {
							let cctt = convertCreditToText(takenCourses[i].credits[ci][0]);
							if (cctt === "Commencement") {
								creds += `${DIVIDER_SVG}<span>${cctt} Credit</span>`;
							} else {
								creds += `${DIVIDER_SVG}<span>${takenCourses[i].credits[ci][1]} ${cctt} Credit</span>`;
							}
						}
						let tmp = `
						<div>
							<h5>${takenCourses[i].name}<span>${
							coursePrerequisitesMet(takenCourses[i])
								? ""
								: "" + WARNING_SVG + " Prerequisites Incomplete"
						}</span></h5>
							<div class="tcf">
								<div class="cid">${takenCourses[i].cid}</div>
								${creds}
							</div>
						</div>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16" id="trash">
							<path id="trash" d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
							<path id="trash" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
						</svg>`;
						let temp = document.createElement("li");
						temp.innerHTML = tmp;
						temp.id =
							"tcipu" +
							Courses.findIndex((e) => {
								return e === takenCourses[i];
							});
						temp.className = "tcf";
						temp.addEventListener("click", (e) => {
							if (e.target.id === "trash") {
								console.log(i);
								takenCourses.splice(i, 1);
								PropagateTakenCourseSearchResults();
								PropagateTakenCourses();
								PropagateCourseChart();
							} else {
								showCourse(Courses[parseInt(e.currentTarget.id.split("tcipu")[1])]);
							}
						});
						frag.appendChild(temp);
					}
					document.getElementById("takenCourses").appendChild(frag);
					if (takenCourses.length === 0) {
						document.getElementById("takenCourses").innerHTML = "<p>Click + to add a Course</p>";
					}
					CalculateDiploma();
				}
				function errorHandle(func) {
					try {
						func();
					} catch (e) {
						presentError(
							"Unknown Error - Contact Creator! <br><br><pre>Name: " +
								e.name +
								"<br>Message: " +
								e.message +
								"<br>Stack: " +
								e.stack +
								"</pre>",
							e
						);
					}
				}
				function loadCall() {
					document.getElementById("addcomplete").addEventListener("click", () => {
						document.getElementById("addcompletebox").style.display = "flex";
						errorHandle(PropagateTakenCourseSearchResults);
					});
					document.getElementById("addcompleteclose").addEventListener("click", () => {
						document.getElementById("addcompletebox").style.display = "none";
					});
					document.getElementById("addcompletename").addEventListener("keyup", () => {
						errorHandle(PropagateTakenCourseSearchResults);
					});
					document.getElementById("addcompletecid").addEventListener("keyup", () => {
						errorHandle(PropagateTakenCourseSearchResults);
					});
					document.getElementById("infoclose").addEventListener("click", () => {
						document.getElementById("infobox").style.display = "none";
					});
					document.getElementById("creditFilter").addEventListener("change", () => {
						errorHandle(PropagateCourseChart);
					});
					document.getElementById("darkLightToggle").addEventListener("change", (e) => {
						if (e.target.checked) {
							document.documentElement.setAttribute("data-theme", "dark");
							isDarkMode = true;
						} else {
							document.documentElement.setAttribute("data-theme", "light");
							isDarkMode = false;
						}
						PropagateTakenCourses();
						PropagateCourseChart();
					});
					let gradeFilters = document.getElementsByClassName("glfi")
					// GLFI = Grade Level Filter Index
					for (let glfi = 0; glfi < gradeFilters.length; glfi++) {
						gradeFilters[glfi].addEventListener("change", (e) => {
							filterGrades = []
							let gradeFilters = document.getElementsByClassName("glfi")
							let overrideFalse = false
							if (gradeFilters[0].checked && e.target.checked && e.target != gradeFilters[0]) {
								gradeFilters[0].checked = false
							} else if (gradeFilters[0].checked) {
								filterGrades = [9,10,11,12]
								overrideFalse = true
							}
							for (let glfi = 0; glfi < gradeFilters.length; glfi++) {
								if (overrideFalse && glfi != 0) {
									gradeFilters[glfi].checked = false
									continue
								}
								if (gradeFilters[glfi].checked) {
									filterGrades.push(8+glfi)
								}
							}
							PropagateCourseChart()
						})
					}
					gradeFilters[0].checked = true
                    if (isDarkMode) {
                        document.getElementById("darkLightToggle").checked = true;
                    }
					errorHandle(CalculateDiploma);
					errorHandle(PropagateCourseChart);
				}
				function CalculateDiploma() {
					let e = (id, value) => {
						let cv = parseFloat(document.getElementById(id).innerText) + value;
						document.getElementById(id).innerText = cv;
						if (cv >= parseFloat(document.getElementById(id + "-t").innerText)) {
							document.getElementById(id).className = "accepted";
							document.getElementById(id + "-s").innerHTML = CHECKMARK_SVG + "&nbsp;";
						}
						if (cv < parseFloat(document.getElementById(id + "-t").innerText)) {
							document.getElementById(id).className = "failed";
							document.getElementById(id + "-s").innerHTML = X_SVG + "&nbsp;";
						}
					};
					let r = (id) => {
						document.getElementById(id).innerText = 0;
						document.getElementById(id).className = "failed";
						document.getElementById(id + "-s").innerHTML = X_SVG + "&nbsp;";
					};
					r("rd-tc");
					r("rd-ec");
					r("rd-ssc");
					r("rd-mc");
					r("rd-sc");
					r("rd-pec");
					r("rd-wlc");
					r("rd-hc");
					r("rd-cc");
					for (let i = 0; i < takenCourses.length; i++) {
						for (let ci = 0; ci < takenCourses[i].credits.length; ci++) {
							let ca = takenCourses[i].credits[ci][1];
							e("rd-tc", ca);
							switch (takenCourses[i].credits[ci][0]) {
								case ENGLISH_CREDIT:
									e("rd-ec", ca);
									break;
								case SOCIAL_STUDY_CREDIT:
									e("rd-ssc", ca);
									break;
								case MATH_CREDIT:
									e("rd-mc", ca);
									break;
								case SCIENCE_CREDIT:
									e("rd-sc", ca);
									break;
								case PHYSICAL_EDUCATION_CREDIT:
									e("rd-pec", ca);
									break;
								case WORLD_LANGUAGE_CREDIT:
									e("rd-wlc", ca);
									break;
								case HEALTH_CREDIT:
									e("rd-hc", ca);
									break;
								case MEETS_COMMENCEMENT_CREDIT:
									e("rd-cc", 1);
									break;
							}
						}
					}
				}
				function FilterCourse(course) {
					if (course === undefined) {
						return false;
					}
					let selectedCredit = document.getElementById("creditFilter").value;
					let creditText = convertCreditToText(course.credits[0][0]);
					if (selectedCredit != "Any Credit") {
						if (selectedCredit != creditText) {
							if (selectedCredit != "Music") {
								return true;
							} else if (creditText != "Music (S Dev.)" && creditText != "Music (K/A Dev.)") {
								return true;
							}
						}
					}
					var continued = false
					for (let i = 0; i < course.grade.length; i++) {
						if (filterGrades.findIndex((e) => e === course.grade[i]) != -1) {
							continued = true
							break
						}
					}
					if (!continued) return true
					return false;
				}
				function PropagateCourseChart() {
					var layout = {
						font: {
							size: 10,
						},
						margin: {
							t: 10,
							l: 10,
							r: 10,
							b: 10,
						},
						template: isDarkMode ? plotly_dark : {},
					};
					var appendData = [];
					try {
						scannedCourses = [];
						for (let i = 0; i < Courses.length; i++) {
							appendData.push(
								...preSearch(
									Courses[i].name,
									Courses[i].prerequisites,
									Courses[i].prerequisite_types,
									true
								)
							);
						}
					} catch (e2) {
						presentError(e2, e2, " - Data Parsing");
					}
					var label = [];
					var color = [];
					var linkcolor = [];
					var source = [];
					var target = [];
					var value = [];
					for (var i = 0; i < appendData.length; i++) {
						var inID = label.findIndex((e) => {
							return e === appendData[i][0] || e === appendData[i][0] + " &#10003;";
						});
						let inCourseID = Courses.findIndex((e) => {
							return e.name === appendData[i][1] || e.name === appendData[i][1] + " &#10003;";
						});
						if (FilterCourse(Courses[inCourseID])) {
							continue;
						}
						let greyify = false;
						if (inID === -1) {
							let taken =
								takenCourses.findIndex((e) => {
									return e.name === appendData[i][0];
								}) === -1;
							label.push(taken ? appendData[i][0] : appendData[i][0] + " &#10003;");
							let or_check = coursePrerequisitesMet(Courses[inCourseID], true);
							if (or_check[0] && appendData[i][2] === PREREQUISITE_OR && or_check[1]) {
								color.push(taken ? LIGHT_GREY : LIGHT_GREEN);
								if (taken) {
									greyify = true;
								}
							} else {
								color.push(taken ? convertPrerequisiteTypeToColor(appendData[i][2]) : LIGHT_GREEN);
							}
							inID = label.length - 1;
						}
						var outID = label.findIndex((e) => {
							return e === appendData[i][1] || e === appendData[i][1] + " &#10003;";
						});
						if (outID === -1) {
							let taken =
								takenCourses.findIndex((e) => {
									return e.name === appendData[i][1];
								}) === -1;
							label.push(taken ? appendData[i][1] : appendData[i][1] + " &#10003;");
							color.push(taken ? convertPrerequisiteTypeToColor(appendData[i][2]) : LIGHT_GREEN);
							outID = label.length - 1;
						}
						source.push(inID);
						target.push(outID);
						let lnc = "";
						if (
							takenCourses.findIndex((e) => {
								return e.name === appendData[i][0];
							}) === -1
						) {
							if (greyify) {
								lnc = LIGHT_GREY;
							} else {
								lnc = convertPrerequisiteTypeToColorLight(appendData[i][2]);
							}
						} else {
							lnc = LIGHT_GREEN;
						}
						linkcolor.push(lnc);
						value.push(1);
					}
					var data = {
						type: "sankey",
						orientation: "h",
						node: {
							pad: 10,
							thickness: 5,
							line: {
								color: "black",
								width: 0,
							},
							label: label,
							color: color,
						},

						link: {
							source: source,
							target: target,
							value: value,
							color: linkcolor,
						},
						//arrangement: 'snap',
						hoverinfo: false,
					};
					var data = [data];
					Plotly.react("allc", data, layout, {
						scrollZoom: true,
						responsive: true,
						modebar_add: ["zoom", "pan"],
					});
				}
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute("data-theme", "dark");
                    isDarkMode = true;
                }
                // Generate Build ID
				//(()=>{let d=new Date();let bi=d.getMonth()+""+d.getDate()+""+d.getFullYear()+""+d.getHours()+""+d.getMinutes()+""+d.getSeconds();presentError(bi,""," - BuildID");})()
			} catch (e) {
				if (e instanceof NotFound) {
					presentError(
						e.message,
						e,
						" - CodeNotFound"
					);
				} else {
					presentError(
						"Unknown Error - Contact Creator! <br><br><pre>Name: " +
							e.name +
							"<br>Message: " +
							e.message +
							"<br>Stack: " +
							e.stack +
							"</pre>",
						e
					);
				}
			}
		</script>
		<link rel="stylesheet" href="./style.css">
	</head>
	<body>
		<div id="res" style="display: none">
			<h2>Regents Exam Score</h2>
			<label>Required to Calculate Diploma Progress</label>
			<input type="text" placeholder="0%" id="resinp"/>
			<button id="rescalc">Calculate</button>
		</div>
		<div id="addcompletebox" style="display: none">
			<div>
				<h3>Add Taken Course</h3>
				<label for="addcompletename">Course Name:</label>
				<input
					type="text"
					name="addcompletename"
					id="addcompletename"
					placeholder="Start Typing..."
				/>
				<label for="addcompletecid">Course ID:</label>
				<input
					type="text"
					name="addcompletecid"
					id="addcompletecid"
					placeholder="Start Typing..."
				/>
				<button id="addcompleteclose">Close</button>
			</div>
			<div id="addcompletesugg">
				<h4>Courses</h4>
				<ul id="addcompletesugglist"></ul>
			</div>
		</div>
		<div id="infobox" style="display: none">
			<div id="infoboxdata">
				<h3>Name</h3>
				<label>Course ID:</label>
				<div></div>
				<label>Credits:</label>
				<div></div>
				<label>Exams:</label>
				<div></div>
				<button id="infoclose">Close</button>
			</div>
			<div>
				<h4>Prerequisites - <span id="pretitle"></span></h4>
				<div id="pres"></div>
				<div id="preflow"></div>
				<legend id="prelegend">
					<svg
						preserveAspectRatio="none"
						width="7"
						height="7"
						class="color"
						style="--c: #77ff77"
						viewBox="0 0 7 7"
					>
						<circle cx="3.5" cy="3.5" r="7"></circle>
					</svg>
					<div>Complete</div>
					<svg
						preserveAspectRatio="none"
						width="7"
						height="7"
						class="color"
						style="--c: #cccccc"
						viewBox="0 0 7 7"
					>
						<circle cx="3.5" cy="3.5" r="7"></circle>
					</svg>
					<div>NA</div>
					<svg
						preserveAspectRatio="none"
						width="7"
						height="7"
						class="color"
						style="--c: red"
						viewBox="0 0 7 7"
					>
						<circle cx="3.5" cy="3.5" r="7"></circle>
					</svg>
					<div>Required</div>
					<svg
						preserveAspectRatio="none"
						width="7"
						height="7"
						class="color"
						style="--c: blue"
						viewBox="0 0 7 7"
					>
						<circle cx="3.5" cy="3.5" r="7"></circle>
					</svg>
					<div>Either</div>
					<svg
						preserveAspectRatio="none"
						width="7"
						height="7"
						class="color"
						style="--c: yellow"
						viewBox="0 0 7 7"
					>
						<circle cx="3.5" cy="3.5" r="7"></circle>
					</svg>
					<div>Recommended</div>
				</legend>
			</div>
		</div>
		<div id="errorbox" style="display: none">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				width="64"
				height="64"
				fill="currentColor"
				class="bi bi-exclamation-triangle-fill"
				viewBox="0 0 16 16"
			>
				<path
					d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"
					fill="#ff0000"
				/>
			</svg>
			<h4>Error<span id="errortype"></span></h4>
			<p id="errormessage"></p>
		</div>
		<div>
			<div class="header">
				<h2>Taken Courses</h2>
				<button id="addcomplete">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="currentColor"
						class="bi bi-plus"
						viewBox="0 0 16 16"
					>
						<path
							d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"
						/>
					</svg>
				</button>
			</div>
			<ul id="takenCourses">
				<p>Click + to add a Course</p>
			</ul>
		</div>
		<div>
			<div class="header">
				<h2>All Courses</h2>
			</div>
			<div id="filters">
				<div class="selectContainer">
					<select id="creditFilter">
						<option>Any Credit</option>
						<option>Math</option>
						<option>English</option>
						<option>Science</option>
						<option>Music</option>
						<option>Health</option>
						<option>P.E.</option>
					</select>
				</div>
				<div class="divider"></div>
				<div id="gradeLevelFiltering">
					<label>
						<input type="checkbox" id="any" class="glfi">
						<span class="glfs">Any Grade</span>
					</label>
					<label>
						<input type="checkbox" id="g9" class="glfi">
						<span class="glfs">9th</span>
					</label>
					<label>
						<input type="checkbox" id="g10" class="glfi">
						<span class="glfs">10th</span>
					</label>
					<label>
						<input type="checkbox" id="g11" class="glfi">
						<span class="glfs">11th</span>
					</label>
					<label>
						<input type="checkbox" id="g12" class="glfi">
						<span class="glfs">12th</span>
					</label>
				</div>
				<div class="divider"></div>
			</div>
			<div id="allc"></div>
			<legend id="prelegend">
				<svg
					preserveAspectRatio="none"
					width="7"
					height="7"
					class="color"
					style="--c: #77ff77"
					viewBox="0 0 7 7"
				>
					<circle cx="3.5" cy="3.5" r="7"></circle>
				</svg>
				<div>Complete</div>
				<svg
					preserveAspectRatio="none"
					width="7"
					height="7"
					class="color"
					style="--c: #cccccc"
					viewBox="0 0 7 7"
				>
					<circle cx="3.5" cy="3.5" r="7"></circle>
				</svg>
				<div>NA</div>
				<svg
					preserveAspectRatio="none"
					width="7"
					height="7"
					class="color"
					style="--c: red"
					viewBox="0 0 7 7"
				>
					<circle cx="3.5" cy="3.5" r="7"></circle>
				</svg>
				<div>Required</div>
				<svg
					preserveAspectRatio="none"
					width="7"
					height="7"
					class="color"
					style="--c: blue"
					viewBox="0 0 7 7"
				>
					<circle cx="3.5" cy="3.5" r="7"></circle>
				</svg>
				<div>Either</div>
				<svg
					preserveAspectRatio="none"
					width="7"
					height="7"
					class="color"
					style="--c: yellow"
					viewBox="0 0 7 7"
				>
					<circle cx="3.5" cy="3.5" r="7"></circle>
				</svg>
				<div>Recommended</div>
			</legend>
		</div>
		<div>
			<div class="header">
				<h2>Diploma Progress</h2>
			</div>
			<div class="diplomaarea">
				<div class="diploma">
					<h3>Regents Diploma</h3>
					<div>
						<div id="rd-tc-s"></div>
						<label>Total Credits:&nbsp;</label>
						<div id="rd-tc" class="failed">0</div>
						<div>/</div>
						<div id="rd-tc-t">22</div>
					</div>
					<div>
						<div id="rd-ec-s"></div>
						<label>English Credits:&nbsp;</label>
						<div id="rd-ec" class="failed">0</div>
						<div>/</div>
						<div id="rd-ec-t">4</div>
					</div>
					<div>
						<div id="rd-ssc-s"></div>
						<label>Social Studies Credits:&nbsp;</label>
						<div id="rd-ssc" class="failed">0</div>
						<div>/</div>
						<div id="rd-ssc-t">4</div>
					</div>
					<div>
						<div id="rd-mc-s"></div>
						<label>Math Credits:&nbsp;</label>
						<div id="rd-mc" class="failed">0</div>
						<div>/</div>
						<div id="rd-mc-t">3</div>
					</div>
					<div>
						<div id="rd-sc-s"></div>
						<label>Science Credits:&nbsp;</label>
						<div id="rd-sc" class="failed">0</div>
						<div>/</div>
						<div id="rd-sc-t">3</div>
					</div>
					<div>
						<div id="rd-pec-s"></div>
						<label>P.E. Credits:&nbsp;</label>
						<div id="rd-pec" class="failed">0</div>
						<div>/</div>
						<div id="rd-pec-t">2</div>
					</div>
					<div>
						<div id="rd-wlc-s"></div>
						<label>World Language Credits:&nbsp;</label>
						<div id="rd-wlc" class="failed">0</div>
						<div>/</div>
						<div id="rd-wlc-t">1</div>
					</div>
					<div>
						<div id="rd-hc-s"></div>
						<label>Health Credits:&nbsp;</label>
						<div id="rd-hc" class="failed">0</div>
						<div>/</div>
						<div id="rd-hc-t">1</div>
					</div>
					<div>
						<div id="rd-cc-s"></div>
						<label>Commencement:&nbsp;</label>
						<div id="rd-cc" class="failed">0</div>
						<div>/</div>
						<div id="rd-cc-t">1</div>
					</div>
				</div>
			</div>
		</div>
		<div id="darkLightToggleContainer">
			<p>Dark Mode</p>
			<label class="switch">
				<input type="checkbox" id="darkLightToggle" />
				<span class="slider round"></span>
			</label>
		</div>
		<footer>
			Version 0.1 Alpha (Build <span id="buildid">172024185201</span>) -
			<a href="https://github.com/SGOTI2/course">Github</a> -
			<a href="https://github.com/SGOTI2/course/issues">Issues</a>
		</footer>
		<!--
			<div id="scrollarea" style="--zoom: 0.3">
				<div id="sankey_basic"></div>
			</div>
		--></body>
</html>
